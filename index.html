<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Board of Trustees Portal</title>
    
    <!-- External Libraries -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Base URL for all relative paths -->
    <base href="/">
    
    <!-- Shared Styles -->
    <link href="css/styles.css" rel="stylesheet">
</head>
<body>
    <!-- ==========================================
         LOGIN SCREEN (Simplified)
         ========================================== -->
    <div class="login-screen" id="loginScreen">
        <div class="login-container">
            <div class="login-logo"><i class="fas fa-shield-alt"></i></div>
            <h1>Board of Trustees Portal</h1>
            <p>Secure Governance & Compliance Platform</p>
            
            <div id="loginForm">
                <div class="form-group">
                    <label>Email Address</label>
                    <input type="email" id="loginEmail" placeholder="Enter your email" autocomplete="email">
                </div>
                
                <div class="form-group">
                    <label>Password</label>
                    <input type="password" id="loginPassword" placeholder="Enter your password" autocomplete="current-password">
                </div>

                <button class="btn btn-primary" onclick="login()">
                    <i class="fas fa-sign-in-alt"></i> Sign In
                </button>

                <div style="margin-top: 1rem; display: flex; justify-content: space-between; font-size: 0.85rem;">
                    <a href="#" onclick="showForgotPassword()" style="color: var(--primary);">Forgot password?</a>
                    <a href="#" onclick="showCreateOrganization()" style="color: var(--primary);">Create organization</a>
                </div>
            </div>

            <!-- Organization Selection (hidden by default) -->
            <div id="organizationSelector" style="display: none;">
                <p style="margin-bottom: 1rem;">Select an organization to continue:</p>
                <div id="organizationList" style="display: flex; flex-direction: column; gap: 0.75rem; margin-bottom: 1.5rem;">
                    <!-- Organizations will be loaded here -->
                </div>
                <button class="btn btn-secondary" onclick="backToLogin()" style="width: 100%;">
                    <i class="fas fa-arrow-left"></i> Back to Login
                </button>
            </div>

            <p style="margin-top: 1.5rem; font-size: 0.8rem; color: var(--text-light);">
                <i class="fas fa-lock"></i> Secured with 256-bit encryption
            </p>
        </div>
    </div>

    <!-- ==========================================
         MAIN APPLICATION
         ========================================== -->
    <div class="app-container" id="appContainer">
        
        <!-- Mobile Menu Toggle -->
        <button class="menu-toggle" onclick="toggleSidebar()">
            <i class="fas fa-bars"></i>
        </button>

        <!-- Sidebar Overlay -->
        <div class="sidebar-overlay" id="sidebarOverlay" onclick="toggleSidebar()"></div>

        <!-- Sidebar Navigation -->
        <aside class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <div class="sidebar-logo"><i class="fas fa-shield-alt"></i></div>
                <div class="sidebar-brand">
                    <h2>Trustee Portal</h2>
                    <span>Governance Platform</span>
                </div>
            </div>

            <nav class="nav-menu">
                <!-- 1. Dashboard -->
                <a class="nav-item active" data-module="dashboard" onclick="showModule('dashboard', this)">
                    <i class="fas fa-home"></i><span>Dashboard</span>
                </a>
                
                <!-- 2. Recruitment -->
                <a class="nav-item" data-module="recruitment" onclick="showModule('recruitment', this)">
                    <i class="fas fa-user-plus"></i><span>Recruitment</span>
                </a>
                
                <!-- 3. Onboarding -->
                <a class="nav-item" data-module="onboarding" onclick="showModule('onboarding', this)">
                    <i class="fas fa-clipboard-check"></i><span>Onboarding</span>
                </a>
                
                <!-- 4. Training -->
                <a class="nav-item" data-module="training" onclick="showModule('training', this)">
                    <i class="fas fa-graduation-cap"></i><span>Training</span>
                </a>
                
                <!-- 5. Calendar -->
                <a class="nav-item" data-module="calendar" onclick="showModule('calendar', this)">
                    <i class="fas fa-calendar-alt"></i><span>Calendar</span>
                </a>
                
                <!-- 6. Committees -->
                <a class="nav-item" data-module="committees" onclick="showModule('committees', this)">
                    <i class="fas fa-users-cog"></i><span>Committees</span>
                </a>
                
                <!-- 7. Messaging -->
                <a class="nav-item" data-module="messaging" onclick="showModule('messaging', this)">
                    <i class="fas fa-comments"></i><span>Messaging</span>
                </a>
                
                <!-- 8. Trustees -->
                <a class="nav-item" data-module="trustees" onclick="showModule('trustees', this)">
                    <i class="fas fa-users"></i><span>Trustees</span>
                    <span class="nav-badge" id="trusteesNotificationBadge" style="display: none;">0</span>
                </a>
                
                <!-- 9. Tasks -->
                <a class="nav-item" data-module="tasks" onclick="showModule('tasks', this)">
                    <i class="fas fa-tasks"></i><span>Tasks</span>
                </a>
                
                <!-- 9. Meetings -->
                <a class="nav-item" data-module="meetings" onclick="showModule('meetings', this)">
                    <i class="fas fa-calendar-check"></i><span>Meetings</span>
                </a>
                
                <!-- 10. Minutes -->
                <a class="nav-item" data-module="minutes" onclick="showModule('minutes', this)">
                    <i class="fas fa-file-alt"></i><span>Minutes</span>
                </a>
                
                <!-- 11. Policies -->
                <a class="nav-item" data-module="policies" onclick="showModule('policies', this)">
                    <i class="fas fa-book"></i><span>Policies</span>
                </a>
                
                <!-- 12. Billing -->
                <a class="nav-item" data-module="billing" onclick="showModule('billing', this)">
                    <i class="fas fa-credit-card"></i><span>Billing</span>
                </a>
                
                <!-- 13. Admin -->
                <a class="nav-item admin-only" data-module="admin" onclick="showModule('admin', this)">
                    <i class="fas fa-cog"></i><span>Admin</span>
                </a>
                
                <!-- 14. Platform Admin (Super Admin Only) -->
                <a class="nav-item super-admin-only" data-module="platformAdmin" onclick="showModule('platformAdmin', this)" style="display: none;">
                    <i class="fas fa-server"></i><span>Platform Admin</span>
                </a>
            </nav>

            <div class="sidebar-footer" style="padding: 1rem; border-top: 1px solid rgba(255,255,255,0.1);">
                <div style="color: rgba(255,255,255,0.6); font-size: 0.75rem; text-align: center;">
                    <i class="fas fa-shield-alt"></i> Trustee Portal v2.0
                </div>
            </div>
        </aside>

        <!-- Main Content Area -->
        <main class="main-content">
            
            <!-- Top Bar -->
            <div class="top-bar">
                <div class="page-title">
                    <h1 id="pageTitle">Dashboard</h1>
                    <p id="pageSubtitle">Welcome back, here's what's happening</p>
                </div>
                <div class="top-actions">
                    <div class="search-box" id="searchBox">
                        <i class="fas fa-search"></i>
                        <input type="text" id="searchInput" placeholder="Search portal..." onkeyup="handleSearch(event)" onclick="toggleSearchMobile()">
                    </div>
                    <button class="notification-btn" onclick="toggleNotifications()">
                        <i class="fas fa-bell"></i>
                    </button>
                    <div class="notification-panel" id="notificationPanel">
                        <!-- Notifications loaded dynamically from API -->
                        <div class="notification-item" id="noNotifications">
                            <p style="font-size: 0.85rem; color: var(--text-light); text-align: center; padding: 1rem;">
                                No new notifications
                            </p>
                        </div>
                    </div>
                    
                    <!-- User Dropdown Menu -->
                    <div class="user-dropdown-container">
                        <button class="user-dropdown-btn" onclick="toggleUserDropdown()">
                            <img src="" alt="" class="user-avatar-img" id="userAvatarImg" style="display: none;">
                            <div class="user-avatar-placeholder" id="userAvatarPlaceholder">--</div>
                            <span class="user-name" id="userDropdownName">Loading...</span>
                            <i class="fas fa-chevron-down"></i>
                        </button>
                        <div class="user-dropdown-menu" id="userDropdownMenu">
                            <div class="dropdown-header">
                                <strong id="dropdownUserName">User Name</strong>
                                <span id="dropdownUserEmail">email@example.com</span>
                            </div>
                            <div class="dropdown-divider"></div>
                            <a href="#" class="dropdown-item" onclick="showUserProfile(); return false;">
                                <i class="fas fa-user"></i> Profile
                            </a>
                            <a href="#" class="dropdown-item" onclick="showUserAccount(); return false;">
                                <i class="fas fa-cog"></i> Account
                            </a>
                            <div class="dropdown-divider"></div>
                            <a href="#" class="dropdown-item logout" onclick="logout(); return false;">
                                <i class="fas fa-sign-out-alt"></i> Log out
                            </a>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ==========================================
                 MODULE CONTAINERS - Content loaded dynamically
                 ========================================== -->
            
            <!-- Dashboard Module -->
            <div class="module-section active" id="dashboard" data-module-file="modules/dashboard.html"></div>
            
            <!-- Committees Module -->
            <div class="module-section" id="committees" data-module-file="modules/committees.html"></div>
            
            <!-- Meetings Module -->
            <div class="module-section" id="meetings" data-module-file="modules/meetings.html"></div>
            
            <!-- Recruitment Module -->
            <div class="module-section" id="recruitment" data-module-file="modules/recruitment.html"></div>
            
            <!-- Onboarding Module -->
            <div class="module-section" id="onboarding" data-module-file="modules/onboarding.html"></div>
            
            <!-- Training Module -->
            <div class="module-section" id="training" data-module-file="modules/training.html"></div>
            
            <!-- Calendar Module -->
            <div class="module-section" id="calendar" data-module-file="modules/calendar.html"></div>
            
            <!-- Messaging Module -->
            <div class="module-section" id="messaging" data-module-file="modules/messaging.html"></div>
            
            <!-- Trustees Module -->
            <div class="module-section" id="trustees" data-module-file="modules/trustees.html"></div>
            
            <!-- Tasks Module -->
            <div class="module-section" id="tasks" data-module-file="modules/tasks.html"></div>
            
            <!-- Minutes Module -->
            <div class="module-section" id="minutes" data-module-file="modules/minutes.html"></div>
            
            <!-- Policies Module -->
            <div class="module-section" id="policies" data-module-file="modules/policies.html"></div>
            
            <!-- Billing Module -->
            <div class="module-section" id="billing" data-module-file="modules/billing.html"></div>
            
            <!-- Admin Module -->
            <div class="module-section" id="admin" data-module-file="modules/admin.html"></div>
            
            <!-- Platform Admin Module (Super Admin) -->
            <div class="module-section" id="platformAdmin" data-module-file="modules/platform-admin.html"></div>
            
            <!-- Profile Module (User Profile) -->
            <div class="module-section" id="profile" data-module-file="modules/profile.html"></div>
            
            <!-- Account Module (Account Settings) -->
            <div class="module-section" id="account" data-module-file="modules/account.html"></div>

        </main>
    </div>

    <!-- ==========================================
         SETUP WIZARD (First Time Setup)
         ========================================== -->
    <div id="setupWizardContainer" style="display: none;"></div>

    <!-- ==========================================
         GLOBAL COMPONENTS
         ========================================== -->
    
    <!-- Toast Container -->
    <div class="toast-container" id="toastContainer"></div>

    <!-- Modal -->
    <div class="modal-overlay" id="modalOverlay">
        <div class="modal">
            <div class="modal-header">
                <h2 id="modalTitle">Modal Title</h2>
                <button class="modal-close" onclick="closeModal()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body" id="modalBody"></div>
            <div class="modal-footer" id="modalFooter">
                <button class="btn btn-secondary" onclick="closeModal()">Cancel</button>
                <button class="btn btn-primary" id="modalConfirmBtn" onclick="confirmAction()">Confirm</button>
            </div>
        </div>
    </div>

    <!-- ==========================================
         SCRIPTS
         ========================================== -->
    
    <!-- Main Application Logic -->
    <script src="js/api.js"></script>
    <script src="js/currency.js"></script>
    <script src="js/app.js"></script>
    <script src="js/trustees.js"></script>
    <script src="js/platform-admin.js"></script>
    <script src="js/profile-account.js"></script>
    
    <!-- Module Loader - Dynamically loads module HTML files -->
    <script>
        // Load all module content on startup
        document.addEventListener('DOMContentLoaded', function() {
            const modules = document.querySelectorAll('.module-section[data-module-file]');
            
            modules.forEach(module => {
                const file = module.getAttribute('data-module-file');
                
                // Use fetch to load module HTML
                fetch(file)
                    .then(response => {
                        if (!response.ok) throw new Error('Failed to load ' + file);
                        return response.text();
                    })
                    .then(html => {
                        // Extract just the inner content from the module file
                        // Remove the outer div with class="module-section" since we already have that
                        const tempDiv = document.createElement('div');
                        tempDiv.innerHTML = html;
                        const innerContent = tempDiv.querySelector('.module-section');
                        if (innerContent) {
                            module.innerHTML = innerContent.innerHTML;
                        } else {
                            module.innerHTML = html;
                        }
                    })
                    .catch(error => {
                        console.error('Error loading module:', file, error);
                        module.innerHTML = '<div class="card"><div class="card-body"><p style="color: var(--danger);">Error loading module. Please refresh the page.</p></div></div>';
                    });
            });
        });
    </script>
</body>
</html>
